# Инструкция по размещению на Hugging Face Spaces (Streamlit SDK)

## Шаг 1: Подготовка проекта для деплоя

1. Убедитесь, что у вас есть все необходимые файлы проекта:
   - `app.py` - главный файл Streamlit приложения с интерфейсом генерации комментариев
   - `train_model.py` - код для обучения и использования модели, включая потоковую генерацию
   - `data_preparation.py` - код для подготовки данных
   - `train_on_startup.py` - скрипт для автоматического обучения модели
   - `requirements.txt` - зависимости проекта
   - `README.md` - описание проекта
   - `LICENSE` - лицензия MIT
   - директория `data/` с необходимыми данными

2. Убедитесь, что ваш файл `requirements.txt` содержит все необходимые зависимости:
   ```
   transformers==4.30.2
   pandas==2.0.3
   numpy==1.24.3
   streamlit==1.24.0
   python-dotenv==1.0.0
   pytube==15.0.0
   matplotlib==3.7.2
   tqdm==4.65.0
   ```

## Шаг 2: Создание Space на Hugging Face

1. Создайте аккаунт на [Hugging Face](https://huggingface.co/), если у вас его нет
2. Зайдите в раздел [Spaces](https://huggingface.co/spaces)
3. Нажмите кнопку "Create new Space"
4. Укажите:
   - **Owner**: ваш аккаунт
   - **Space name**: `youtube-comments-generator` (или другое имя по вашему выбору)
   - **SDK**: выберите Streamlit (обязательно!)
   - **Space hardware**: рекомендуется GPU (для более быстрого обучения модели и генерации)
   - **Visibility**: Public (как требуется)
   - **License**: MIT

5. Нажмите "Create Space"

## Шаг 3: Загрузка файлов проекта

1. После создания Space вы будете перенаправлены на страницу вашего проекта
2. Нажмите на "Files" в верхней части страницы
3. Загрузите все файлы проекта:
   - Можно загрузить через веб-интерфейс (Upload files)
   - Или через Git: клонировать репозиторий, добавить файлы, затем push

## Шаг 4: Обучение модели

Поскольку обучение модели GPT-2 требует значительных ресурсов, у вас есть два варианта:

### Вариант 1: Обучить модель заранее и загрузить веса (рекомендуется)
1. Обучите модель локально:
   ```python
   from train_model import CommentGenerationModel
   model = CommentGenerationModel(model_name='gpt2-large', output_dir='./model_output')
   model.load_tokenizer_and_model()
   train_path, test_path = model.prepare_dataset(csv_path='data/processed/train.csv', 
                                                output_dir='data/prepared', 
                                                column_name='clean_text')
   train_dataset = model.load_dataset(train_path)
   test_dataset = model.load_dataset(test_path)
   model.train(train_dataset, test_dataset)
   ```
2. Загрузите директорию `model_output` на Hugging Face

### Вариант 2: Обучение модели на Hugging Face (при наличии GPU)
1. В проект уже добавлен файл `train_on_startup.py`, который обучит модель при первом запуске
2. В `app.py` есть проверка наличия модели и автоматический запуск обучения
3. Этот вариант может занять от нескольких часов до нескольких дней в зависимости от выбранного вами оборудования

## Шаг 5: Настройка параметров Space (опционально)

В настройках Space можно указать дополнительные параметры:

1. Перейдите в раздел "Settings" вашего Space
2. **Hardware**: Для быстрой работы рекомендуется выбрать GPU
3. **Secrets**: Если вы используете API-ключи, их можно добавить в этом разделе
4. **Embed options**: Настройте параметры встраивания вашего Space на других сайтах
5. **Delete/Restart**: Кнопки для перезапуска или удаления Space

## Шаг 6: Проверка работы приложения

1. После загрузки всех файлов Hugging Face автоматически запустит ваше приложение
2. Вы увидите статус сборки в разделе "Factory"
3. После успешного деплоя ваше приложение будет доступно по URL:
   `https://huggingface.co/spaces/[ваш-аккаунт]/[название-space]`

4. Проверьте все функции приложения:
   - Ввод URL видео
   - Генерация комментариев
   - Работа режима потоковой генерации
   - Переключение между Sampling и Beam Search
   - Генерация ответов на комментарии

## Шаг 7: Обновление приложения

1. Для обновления просто загрузите измененные файлы в репозиторий
2. Hugging Face автоматически перезапустит приложение

## Оптимизация производительности

1. **Для потоковой генерации**: 
   - Если потоковая генерация работает медленно, увеличьте в настройках Space объем выделенной памяти
   - При необходимости можно отключить потоковую генерацию в UI

2. **Для Beam Search**:
   - Значения beam size > 5 могут существенно замедлить генерацию на CPU
   - При использовании GPU можно выбирать более высокие значения

3. **При высокой нагрузке**:
   - Ограничьте максимальное количество комментариев для генерации
   - Уменьшите максимальную длину комментария

## Примечания

1. Первая загрузка Space может занять некоторое время из-за обучения модели
2. Следите за логами для отладки в разделе "Factory" на странице вашего Space
3. Если у вас возникают проблемы с памятью, уменьшите значения параметров `per_device_train_batch_size` в файле `train_on_startup.py`

## Полезные ссылки

- [Hugging Face Spaces Documentation](https://huggingface.co/docs/hub/spaces)
- [Streamlit Documentation](https://docs.streamlit.io/)
- [Transformers Documentation](https://huggingface.co/transformers/) 